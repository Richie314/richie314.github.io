"use strict";function DrawCircleAndPolygon(e,i,n){i.clearRect(0,0,e.width,e.height),i.fillStyle=_Colors.Bg[1],i.strokeStyle=_Colors.Bg[1],i.lineWidth=2.5,i.beginPath(),i.arc(e.width/2,e.height/2,e.width/2-1,0,2*Math.PI),i.stroke(),i.fill(),i.closePath(),DrawPolygon(e,i,n)}function PiArchimedeRecursive(e,i){const n="number"==typeof e?new Decimal(e):e;if(i<=6||i%2!=0)return n;const t=PiArchimedeRecursive(n,i/2);return n.minus(n.pow(2).minus(t.dividedBy(2).pow(2)).sqrt()).times(2).times(n).sqrt()}function DrawPolygon(e,i,n){i.beginPath(),i.moveTo(e.width,e.height/2),i.strokeStyle=_Colors.Cols[1],i.lineWidth=2.5;const t=2*Math.PI/n;for(let n=t;n<2*Math.PI;n+=t)i.lineTo((Math.cos(n)+1)*e.width/2,(Math.sin(-n)+1)*e.height/2);i.lineTo(e.width,e.height/2),i.stroke(),i.closePath()}function factorial(e){var i=new Decimal(1);if(e<2)return i;for(var n=2;n<=e;i=i.times(n++));return i}function gcd(e,i){let n=e.minus(i);for(;0!==n.comparedTo(0);)n.isPositive()?e=e.dividedBy(n):i=i.dividedBy(n.negated()),n=e.minus(i);return e}function CoPrime(e,i){return gcd(e,i).equals(1)}const _Colors={Cols:["#112d4e","#112d4e","#dbe2ef"],Bg:["#f9f7f7","#dbe2ef","#3f72af"]};var block1,block2,ArchimedesInput=document.getElementById("archimedes-input"),ArchimedesReceive=document.getElementById("archimedes-receive"),archimedescanvas=document.getElementById("archimedes-canvas"),a_ctx=archimedescanvas.getContext("2d"),archimedes_div=document.getElementById("method-archimedes"),archimedescanvas2=document.getElementById("archimedes-canvas-2"),a2_ctx=archimedescanvas2.getContext("2d"),ArchimedesInput2=document.getElementById("archimedes-input-2"),ArchimedesReceive2=document.getElementById("archimedes-receive-2"),oldArchimedesN=12,LeibnizInput=document.getElementById("leibniz-input"),LeibnizReceive=document.getElementById("leibniz-receive"),Leibniz_div=document.getElementById("method-leibniz"),RamanujanInput=document.getElementById("ramanujan-input"),RamanujanReceive=document.getElementById("ramanujan-receive"),Ramanujan_div=document.getElementById("method-ramanujan"),CollisionInput=document.getElementById("collision-input"),CollisionBtn=document.getElementById("collision-start"),CollisionReceive=document.getElementById("collision-receive"),CollisionCanvas=document.getElementById("collision-canvas"),Collision_div=document.getElementById("method-collisions"),ctx=CollisionCanvas.getContext("2d"),total=new Decimal(0),steps=new Decimal(0),currentPi=new Decimal(0),defauldDecimalJsPi=Decimal.acos(-1),PiCollideBlock=class{constructor(e,i,n,t,o){this.x="number"==typeof e?new Decimal(e):e,this.y=Decimal.sub(CollisionCanvas.height,i),this.w="number"==typeof i?new Decimal(i):i,this.v="number"==typeof t?new Decimal(t):t,this.m="number"==typeof n?new Decimal(n):n,this.xvarraint="number"==typeof o?new Decimal(o):o}get hitWall(){return this.x.lessThan(0)}get xw(){return this.x.plus(this.w)}reverse(){this.v=this.v.times(-1)}collide(e){return!(this.xw.lessThan(e.x)||e.xw.lessThan(this.x))}bounce(e){const i=this.m.plus(e.m);return new Decimal(this.m.minus(e.m).dividedBy(i).times(this.v).plus(e.m.times(2).dividedBy(i).times(e.v)))}update(){this.x=this.x.plus(this.v)}show(e){e.fillStyle=_Colors.Cols[0],e.fillRect(this.x.toNumber()+10,this.y.toNumber(),this.w.toNumber(),this.w.toNumber())}},RandomInput=document.getElementById("random-input"),RandomReset=document.getElementById("random-reset"),RandomSelect=document.getElementById("random-function-select"),RandomReceive=document.getElementById("random-receive"),RandomReceiveCanvas=document.getElementById("random-canvas-1"),RandomCtx=RandomReceiveCanvas.getContext("2d"),Random_div=document.getElementById("method-random"),RandomBtn=document.getElementById("random-btn"),RandomTotal=document.getElementById("random-total");const PI_30_DIGITS=["1415926535","8979323846","2643383279"].join("");var RandomGeneratorMethods={default:()=>new Decimal(Math.random()),decimalJS:()=>Decimal.random()},Pi={CheckUserInput:e=>(e.value=Math.min(e.value,e.max),e.value=Math.max(e.value,e.min),Number(e.value)),Archimedes:async()=>new Promise((()=>{let e=Math.floor(Pi.CheckUserInput(ArchimedesInput));e>2&&(ArchimedesReceive.innerHTML=Decimal.sin(defauldDecimalJsPi.dividedBy(e)).times(e).toSD(8).toString(),DrawCircleAndPolygon(archimedescanvas,a_ctx,e))})),async Archimedes2(e){e&&e.preventDefault();let i=Number(ArchimedesInput2.value);await new Promise((()=>{ArchimedesReceive2.innerHTML=PiArchimedeRecursive(.5,i).times(i).toSD(8).toString(),DrawCircleAndPolygon(archimedescanvas2,a2_ctx,i)}))},LeibnizStarted:!1,async Leibniz(){function e(){let e=new Decimal(1);for(let i=1;i<n;i+=2){const n=t.dividedBy(new Decimal(2*i+1));e=e.minus(n)}return e}function i(){let e=new Decimal(0);for(let i=2;i<n;i+=2){const n=t.dividedBy(new Decimal(2*i+1));e=e.plus(n)}return e}if(Pi.LeibnizStarted)return;let n=Math.floor(Pi.CheckUserInput(LeibnizInput));LeibnizReceive.innerHTML="...",Pi.LeibnizStarted=!0;const t=new Decimal(1);let o,a;await RunParallel([()=>{o=e()},()=>{a=i()}]),LeibnizReceive.innerHTML=o.plus(a).times(4).toSD(30).toString(),Pi.LeibnizStarted=!1},RamanujanStarted:!1,async Ramanujan(){function e(e,i){let n=new Decimal(0);for(var t=e;t<i;t++){const e=Decimal(factorial(6*t)).div(Decimal(factorial(3*t)).times(Decimal(factorial(t)).pow(3))),i=Decimal(545140134).times(t).plus(13591409),o=Decimal(-0x3a4b862c4b40000).pow(t);n=n.plus(e.times(i).div(o))}return n}if(Pi.RamanujanStarted)return;Pi.RamanujanStarted=!0;const i=Math.floor(Pi.CheckUserInput(RamanujanInput));requestAnimationFrame((()=>{RamanujanReceive.innerHTML="..."}));const n=Decimal.precision;Decimal.set({precision:5*i});const t=Math.floor(i/2);let o=await RunParallel([()=>e(0,t),()=>e(t,i)]);const a=Decimal(1).div(Decimal(426880).times(Decimal(10005).sqrt()));let l=Decimal(1).div(a.times(o[0].plus(o[1])));l=l.toSD(30),requestAnimationFrame((()=>{RamanujanReceive.innerHTML=l.toString()})),Pi.RamanujanStarted=!1,Decimal.set({precision:n})},collisionsRunning:!1,collisionDelay:10,collisionDelaysArray:{2:5,3:7,4:7,5:8,6:10,7:15},Collision(){Pi.collisionsRunning=!Pi.collisionsRunning;const e=Math.floor(Pi.CheckUserInput(CollisionInput));this.collisionsRunning&&(CollisionBtn.innerHTML="Abort",currentPi=new Decimal(0),steps=Decimal.pow(10,e-1),block1=new PiCollideBlock(100,20,1,0,0),block2=new PiCollideBlock(300,100,steps.pow(2),new Decimal(-1).dividedBy(steps),20),Pi.collisionDelay=Pi.collisionDelaysArray[e],requestAnimationFrame(Pi.CollisionShow),Pi.CollisionsUpdate().then((()=>{CollisionBtn.innerHTML="Start"})))},async CollisionsUpdate(){async function e(e){return await new Promise((i=>{for(let n=0;e.greaterThan(n);n++){if(block1.collide(block2)){const e=block1.bounce(block2),i=block2.bounce(block1);block1.v=e,block2.v=i,currentPi=currentPi.plus(1)}block1.hitWall&&(block1.reverse(),currentPi=currentPi.plus(1)),block1.update(),block2.update(),i()}}))}if(!Pi.collisionsRunning)return;const i=steps.div(10);for(let n=0;n<10;n++)await e(i),await delay(Pi.collisionDelay);block2.v.greaterThan(block1.v)&&block1.v.isPositive()?Pi.Collision():await Pi.CollisionsUpdate()},CollisionShow(){CollisionReceive.innerHTML=currentPi.toString(),ctx.fillStyle=_Colors.Bg[0],ctx.fillRect(0,0,CollisionCanvas.width,CollisionCanvas.height),ctx.fillStyle=_Colors.Cols[1],ctx.fillRect(0,0,10,CollisionCanvas.height),block1.show(ctx),block2.show(ctx),Pi.collisionsRunning&&requestAnimationFrame(Pi.CollisionShow)},Random(){0===Pi.RandomId?(RandomInput.innerHTML="Pause",Pi.RandomId=setInterval(Pi.RandomUpdate,10)):(RandomInput.innerHTML="Resume",clearInterval(Pi.RandomId),Pi.RandomId=0)},RandomId:0,RandomCurrentPi:{num:new Decimal(0),den:new Decimal(0)},RandomUpdate(){const e=RandomGeneratorMethods[RandomSelect.value],i=e(),n=e();RandomCtx.fillStyle=_Colors.Cols[2],i.pow(2).plus(n.pow(2)).lessThanOrEqualTo(1)&&(Pi.RandomCurrentPi.num=Pi.RandomCurrentPi.num.plus(1),RandomCtx.fillStyle=_Colors.Cols[1]),Pi.RandomCurrentPi.den=Pi.RandomCurrentPi.den.plus(1),RandomReceive.innerHTML=Pi.RandomCurrentPi.num.times(4).dividedBy(Pi.RandomCurrentPi.den).toSD(10).toString(),RandomTotal.innerHTML=Pi.RandomCurrentPi.den.toString(),RandomCtx.beginPath(),RandomCtx.arc(1e3*i.toNumber(),1e3*n.toNumber(),2,0,2*Math.PI),RandomCtx.closePath(),RandomCtx.fill()},RandomReset(){0!==Pi.RandomId&&(clearInterval(Pi.RandomId),Pi.RandomId=0),RandomInput.innerHTML="Start",Pi.RandomCurrentPi.num=new Decimal(0),Pi.RandomCurrentPi.den=new Decimal(1),RandomReceive.innerHTML="0",RandomCtx.clearRect(0,0,RandomReceiveCanvas.width,RandomReceiveCanvas.height)}};Pi.Archimedes(),ArchimedesInput.addEventListener("input",Pi.Archimedes),Pi.Archimedes2(),ArchimedesInput2.addEventListener("input",Pi.Archimedes2),Pi.Leibniz(),LeibnizInput.addEventListener("input",Pi.Leibniz),document.getElementById("collision-start").addEventListener("click",(function(){Pi.Collision()})),ctx.fillStyle=_Colors.Bg[0],ctx.fillRect(0,0,CollisionCanvas.width,CollisionCanvas.height),ctx.fillStyle=_Colors.Cols[1],ctx.fillRect(0,0,10,CollisionCanvas.height),Pi.Ramanujan(),RamanujanInput.addEventListener("input",Pi.Ramanujan),RandomInput.addEventListener("click",Pi.Random),RandomReset.addEventListener("click",Pi.RandomReset);